import xbmc
import xbmcgui
import os 
from xbmctorrent import plugin
MESSAGE_ACTION_OK = 10
LABEL_HEADER = 1
PROGRESSBAR = 12
BACKGROUND_IMAGE = 15
MESSAGE_EXIT = 111
MESSAGE_TITLE = 101
MESSAGE_LINE1 = 102
MESSAGE_LINE2 = 103
MESSAGE_LINE3 = 104

class OverlayWindow(xbmcgui.WindowXMLDialog):

    #https://github.com/taxigps/plugin.program.rssreader/blob/master/plugin.program.rssreader/default.py

    def __init__(self, strXMLname, strFallbackPath, strDefaultName='Default', forceFallback = 0, *args, **kwargs):
        plugin.log.info('in OverlayWindow_____________________________  ')
        xbmcgui.WindowXML.__init__( self )
        self.item = kwargs["item"]
        plugin.log.info(repr(self.item))
        pass

    def onInit(self):
        self.backgroundImage = self.getControl(BACKGROUND_IMAGE)
        self.labelHeader = self.getControl(LABEL_HEADER)
        viewport_w, viewport_h = self._get_skin_resolution()
        plugin.log.info("viewport_w : %s viewport_h : %s" % (str(viewport_w), str(viewport_h)))
        w = int(0.5 * viewport_w)
        h = int(0.5 * viewport_h)
        x = (viewport_w - w) / 2
        y = (viewport_h - h) / 2
        self.backgroundImage.setPosition(x,y)
        # Put your List Populating code/ and GUI startup stuff here
        self.backgroundImage.setWidth(w)
        self.backgroundImage.setHeight(h)
        self.labelHeader.setLabel(self.item['label'])
        pass 

    def onAction(self, action):
        if action == 1010:
            self.close()
    
    def onClick(self, controlID):
        plugin.log.info('controlID : %i' % controlID)
        if controlID == MESSAGE_ACTION_OK or controlID == MESSAGE_EXIT:
            self.onAction(1010)
    
    def onFocus(self, controlID):
        pass
    
    def _get_skin_resolution(self):
        import xml.etree.ElementTree as ET
        skin_path = xbmc.translatePath("special://skin/")
        tree = ET.parse(os.path.join(skin_path, "addon.xml"))
        res = tree.findall("./extension/res")[0]
        return int(res.attrib["width"]), int(res.attrib["height"])