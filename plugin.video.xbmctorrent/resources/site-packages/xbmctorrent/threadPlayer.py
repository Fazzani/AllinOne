import xbmc
import xbmcgui
import time
from xbmctorrent import plugin
from threading import Thread
import xbmcswift2 


class threadPlayer(Thread):
  
  def __init__(self, sleeptime, func, item, isSaison):
      plugin.log.info('********* init thread Player')
      plugin.log.info('********* item %s' % item)
      self.sleeptime = sleeptime
      self.func = func 
      self.item = item
      self._isSaison = isSaison
      self.item['info_type']='video'
      self._listitem = xbmcswift2.ListItem.from_dict(**item).as_xbmc_listitem()
      Thread.__init__(self)
      self.player = xbmc.Player()
      #self.setDaemon(True)
  
  def run(self):
      plugin.log.info('********* run thread Player ')
      while(not self.player.isPlaying()):
        try:
          #do some stuff that takes about 10 seconds
          plugin.log.info("********* str Item %s" % str(self.item))
          self.player.play(item = self.item['path'], listitem = self._listitem)
          plugin.log.info('********* func called its time to sleep ')
          xbmc.sleep(self.sleeptime)
        except e:
          plugin.info.log(str(e))
          pass
      self.func(self.item, self._isSaison)
      plugin.log.info('********* XBMC Player is playing ')
